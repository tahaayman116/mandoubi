# دليل نشر أكواد Google Apps Script

## 📋 نظرة عامة
تم إنشاء 4 ملفات Google Apps Script متكاملة تتناسب مع جميع التحديثات الأخيرة في النظام:

## 📁 الملفات المنشأة

### 1. `google-apps-script-submissions.js`
**الغرض:** إدارة شيت الإرسالات
**الميزات:**
- ✅ حذف حقول "المستلمين" و "غير المستلمين"
- ✅ إضافة حقل "المكان" 
- ✅ تنسيق تلقائي للبيانات
- ✅ إحصائيات شاملة
- ✅ تنظيف البيانات المكررة

### 2. `google-apps-script-representatives.js`
**الغرض:** إدارة شيت المندوبين والمشرفين
**الميزات:**
- ✅ إضافة حقل "المكان" للمندوبين والمشرفين
- ✅ تحديث الإحصائيات تلقائياً
- ✅ تنسيق مرئي للأدوار (مندوب/مشرف)
- ✅ حساب المبالغ الإجمالية

### 3. `google-apps-script-settings.js`
**الغرض:** إدارة إعدادات النظام
**الميزات:**
- ✅ إعدادات الإدارة والنموذج
- ✅ إحصائيات النظام المحدثة
- ✅ نسخ احتياطي تلقائي
- ✅ تحديث دوري للبيانات

### 4. `google-apps-script-main.js`
**الغرض:** التحكم الرئيسي والتكامل
**الميزات:**
- ✅ إعداد النظام الكامل
- ✅ تزامن مع Firebase/Appwrite
- ✅ واجهات برمجة التطبيقات
- ✅ مشغلات تلقائية

## 🚀 خطوات النشر

### الخطوة 1: إنشاء مشروع Google Apps Script
1. اذهب إلى [script.google.com](https://script.google.com)
2. انقر على "مشروع جديد"
3. غير اسم المشروع إلى "نظام إدارة المندوبين"

### الخطوة 2: إضافة الملفات
1. احذف الملف الافتراضي `Code.gs`
2. أنشئ ملف جديد لكل من الملفات الأربعة:
   - `submissions.gs` ← انسخ محتوى `google-apps-script-submissions.js`
   - `representatives.gs` ← انسخ محتوى `google-apps-script-representatives.js`
   - `settings.gs` ← انسخ محتوى `google-apps-script-settings.js`
   - `main.gs` ← انسخ محتوى `google-apps-script-main.js`

### الخطوة 3: ربط Google Sheets
1. أنشئ Google Sheets جديد
2. انسخ رابط الشيت
3. في Apps Script، اذهب إلى المحرر
4. شغل الدالة `setupCompleteSystem()` لإنشاء جميع الشيتات

### الخطوة 4: إعداد الصلاحيات
1. عند تشغيل الكود لأول مرة، ستظهر رسالة طلب صلاحيات
2. اقبل جميع الصلاحيات المطلوبة:
   - الوصول إلى Google Sheets
   - إنشاء مشغلات زمنية
   - الوصول إلى Google Drive

### الخطوة 5: نشر كـ Web App (اختياري)
1. انقر على "نشر" → "نشر جديد"
2. اختر النوع: "تطبيق ويب"
3. اختر "أي شخص" للوصول
4. انقر "نشر"
5. انسخ رابط التطبيق للاستخدام مع Firebase/Appwrite

## 🔧 الوظائف الرئيسية

### وظائف الإعداد الأولي
```javascript
// إعداد النظام الكامل
setupCompleteSystem()

// اختبار شامل
runCompleteSystemTest()
```

### وظائف إدارة البيانات
```javascript
// إضافة إرسال جديد
addSubmission(submissionData)

// إضافة مندوب/مشرف
addRepresentative(repData)

// تحديث الإحصائيات
updateSystemStats()
```

### وظائف الصيانة
```javascript
// تنظيف البيانات المكررة
cleanDuplicateSubmissions()

// صيانة النظام
systemMaintenance()

// إنشاء تقرير شامل
generateSystemReport()
```

## 📊 هيكل البيانات الجديد

### شيت الإرسالات
| العمود | الوصف |
|--------|--------|
| التاريخ | تاريخ الإرسال |
| اسم القرية | اسم القرية |
| العدد الكلي | عدد الأشخاص |
| المبلغ الإجمالي | المبلغ بالجنيه |
| المكان | المكان/المنطقة |
| اسم المندوب/المشرف | اسم المرسل |
| النوع | مندوب أو مشرف |
| الوقت | وقت الإرسال |

### شيت المندوبين والمشرفين
| العمود | الوصف |
|--------|--------|
| الاسم | اسم المندوب/المشرف |
| النوع | مندوب أو مشرف |
| المكان | مكان العمل |
| تاريخ الإضافة | تاريخ التسجيل |
| نشط | حالة النشاط |
| عدد الإرسالات | عدد الإرسالات |
| إجمالي الأشخاص | مجموع الأشخاص |
| إجمالي المبلغ | مجموع المبالغ |

## 🔄 التكامل مع النظام الحالي

### إرسال البيانات من React إلى Google Sheets
```javascript
// في dualDatabaseService.js
const sendToGoogleSheets = async (data, type) => {
  const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      type: type,
      payload: data
    })
  });
  return response.json();
};
```

### استقبال البيانات من Google Sheets
```javascript
// الحصول على الإحصائيات
const getStatsFromSheets = async () => {
  const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=get_stats`);
  return response.json();
};
```

## ⚡ المشغلات التلقائية

سيتم إعداد المشغلات التالية تلقائياً:

1. **تحديث الإحصائيات** - كل ساعة
2. **التزامن مع قواعد البيانات** - كل 6 ساعات  
3. **صيانة النظام** - يومياً في الساعة 2 صباحاً
4. **التقرير الأسبوعي** - كل أحد في الساعة 9 صباحاً

## 🛠️ استكشاف الأخطاء

### مشاكل شائعة وحلولها

1. **خطأ في الصلاحيات**
   - تأكد من قبول جميع الصلاحيات المطلوبة
   - شغل الدالة `setupCompleteSystem()` مرة أخرى

2. **الشيتات لا تظهر**
   - تحقق من أن Google Sheets مرتبط بشكل صحيح
   - شغل `createSubmissionsSheet()` يدوياً

3. **البيانات لا تتحدث**
   - تحقق من المشغلات في قائمة "المشغلات"
   - شغل `setupAutomaticTriggers()` مرة أخرى

## 📞 الدعم والمساعدة

للحصول على المساعدة:
1. تحقق من سجل التنفيذ في Apps Script
2. شغل `runCompleteSystemTest()` للتأكد من عمل جميع الوظائف
3. راجع الأخطاء في قسم "التنفيذ" في Apps Script

---

**ملاحظة:** جميع الأكواد محدثة لتتناسب مع التغييرات الأخيرة في النظام، بما في ذلك حذف حقول "المستلمين" وإضافة حقل "المكان".
